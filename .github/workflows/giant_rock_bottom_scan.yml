# .github/workflows/giant_rock_bottom_scan.yml
name: å·¨çŸ³æ²‰åº•Kçº¿å½¢æ€æ‰«æ

# 1. è§¦å‘æ¡ä»¶é…ç½®
on:
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  # æ¯å¤©åŒ—äº¬æ—¶é—´ 18:00 å®šæ—¶è§¦å‘ (UTC 10:00)
  schedule:
    # '0 10 * * *' -> æ¯å¤© UTC 10:00 è¿è¡Œï¼Œå³åŒ—äº¬æ—¶é—´ 18:00
    - cron: '0 10 * * *'
  # å½“è„šæœ¬æˆ–å·¥ä½œæµæ–‡ä»¶å˜åŠ¨æ—¶è‡ªåŠ¨è§¦å‘
  push:
    paths:
      - 'giant_rock_bottom_scanner.py'
      - '.github/workflows/giant_rock_bottom_scan.yml'
      # ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ•°æ®ç›®å½•çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼š
      # - 'stock_data/**'

# 2. ç¯å¢ƒå˜é‡é…ç½® (è®¾ç½®è¿è¡Œç¯å¢ƒæ—¶åŒºä¸ºä¸Šæµ·ï¼Œç¡®ä¿è„šæœ¬å†…çš„æ—¶é—´æˆ³æ­£ç¡®)
env:
  TZ: Asia/Shanghai

jobs:
  scan_and_commit:
    runs-on: ubuntu-latest
    
    # 3. æ­¥éª¤
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install pandas pytz

      - name: è¿è¡Œ K çº¿å½¢æ€æ‰«æè„šæœ¬
        run: python giant_rock_bottom_scanner.py

      - name: æäº¤å¹¶æ¨é€ç»“æœ
        # è¿™ä¸ªæ­¥éª¤ä¼šå°†è„šæœ¬ç”Ÿæˆçš„æ–°çš„ CSV ç»“æœæ–‡ä»¶æäº¤åˆ°ä»“åº“
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # åªæäº¤æ‰«æç»“æœç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸åŒ…å«å·¥ä»¶
          file_pattern: 'scan_results/**/*.csv'
          commit_message: 'ğŸ¤– è‡ªåŠ¨æ‰«æ: å·¨çŸ³æ²‰åº• K çº¿å½¢æ€ç»“æœæ›´æ–°'
          # è®¾ç½®æäº¤ç”¨æˆ·ï¼Œé¿å…ä½¿ç”¨ GitHub Actions æœºå™¨äººé»˜è®¤ç”¨æˆ·
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'actions@github.com'
          # è®¾ç½® Git ä½œè€…ä¿¡æ¯
          commit_author: 'GitHub Actions Bot <actions@github.com>'
