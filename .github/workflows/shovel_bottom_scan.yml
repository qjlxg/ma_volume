name: ğŸ’° Shovel Bottom Pattern Scan

# å·¥ä½œæµåç§°ï¼Œå¯¹åº”è„šæœ¬åç§°
run-name: ğŸ“ˆ ${{ github.workflow }}_${{ github.ref_name }}

on:
  # 1. æ‰‹åŠ¨è§¦å‘ (å¯ä»¥è¾“å…¥å‚æ•°ï¼Œä½†æ­¤å¤„ä¿æŒç®€å•)
  workflow_dispatch:
    inputs:
      manual_trigger:
        description: 'Manually run the Shovel Bottom scan'
        required: false
        default: 'true'

  # 2. ä»£ç å˜åŠ¨è‡ªåŠ¨è§¦å‘
  push:
    branches:
      - main  # å‡è®¾ä¸»åˆ†æ”¯ä¸º main
      - master
    paths:
      - 'shovel_bottom_scan.py'  # è„šæœ¬å˜åŠ¨
      - '.github/workflows/shovel_bottom_scan.yml' # å·¥ä½œæµå˜åŠ¨

  # 3. å®šæ—¶è§¦å‘ (æ¯å¤© 18:00 åŒ—äº¬æ—¶é—´/ä¸Šæµ·æ—¶åŒº)
  # Cron è¡¨è¾¾å¼: åˆ† æ—¶ å¤© æœˆ å‘¨
  # 0 10 * * * --> UTC æ—¶é—´ 10:00ï¼Œç›¸å½“äºåŒ—äº¬æ—¶é—´ 18:00 (UTC+8)
  schedule:
    - cron: '0 15 * * *'

jobs:
  run_and_commit_results:
    # ä½¿ç”¨ Ubuntu Runner
    runs-on: ubuntu-latest
    
    # è®¾ç½®æ—¶åŒºç¯å¢ƒå˜é‡ä¸ºä¸Šæµ·æ—¶åŒº (åŒ—äº¬æ—¶é—´)
    env:
      TZ: Asia/Shanghai

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        # å¿…é¡»è·å–å†å²è®°å½•ï¼Œä»¥ä¾¿è„šæœ¬æ‰«ææ‰€æœ‰æ–‡ä»¶
        with:
          fetch-depth: 0 

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas glob multiprocessing pytz

      - name: âš™ï¸ Run Shovel Bottom Scan Script
        # è¿è¡Œè„šæœ¬
        run: python shovel_bottom_scan.py

      - name: ğŸ“¤ Commit Results
        # ä½¿ç”¨ Git Auto Commit Action æ¥æäº¤ç”Ÿæˆçš„ç»“æœæ–‡ä»¶
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # åªæäº¤ results/ ç›®å½•ä¸‹çš„ CSV æ–‡ä»¶
          commit_message: "Automatic: Shovel Bottom Scan results update"
          file_pattern: "results/**/*.csv"
          # è®¾ç½®æäº¤è€…ä¿¡æ¯
          commit_user_name: GitHub Actions Bot
          commit_user_email: actions@github.com
          commit_author: GitHub Actions Bot <actions@github.com>
          
# æ³¨æ„ï¼šæ­¤å·¥ä½œæµå°†ç»“æœæ¨é€åˆ°ä»“åº“ï¼Œè€Œä¸æ˜¯ä¸Šä¼ åˆ°å·¥ä»¶ (Artifacts)ã€‚
# å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦é¢å¤–çš„ 'actions/upload-artifact@v4' æ­¥éª¤ã€‚
