name: Healthy Pullback Screener

on:
  schedule:
    - cron: '0 15 * * *'
  
  workflow_dispatch:
  
  push:
    branches:
      - main
    paths:
      - 'healthy_pullback_screener.py'
      - '.github/workflows/healthy_pullback_screener.yml'

jobs:
  screen_stocks:
    runs-on: ubuntu-latest
    
    env:
      TZ: Asia/Shanghai

    steps:
      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: pip install pandas

      - name: âš™ï¸ è¿è¡Œè‚¡ç¥¨ç­›é€‰è„šæœ¬
        run: python healthy_pullback_screener.py

      - name: â¬†ï¸ æ¨é€ç»“æœæ–‡ä»¶åˆ°ä»“åº“
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          OUTPUT_DIR=$(date +%Y%m)
          
          git add $OUTPUT_DIR/*.csv
          
          if git diff --cached --quiet; then
            echo "No new results to commit."
          else
            COMMIT_MESSAGE="Feat: Add healthy pullback screening results for $(date +%Y-%m-%d)"
            git commit -m "$COMMIT_MESSAGE"
            git push
            echo "Successfully pushed new results."
          fi
